import 'package:flutter/material.dart';
import 'package:playlistmaster/states/my_navigation_button_state.dart';
import 'package:playlistmaster/widgets/floating_button/quick_action.dart';
import 'package:playlistmaster/widgets/floating_button/quick_action_menu.dart';
import 'package:playlistmaster/widgets/my_footer.dart';
import 'package:provider/provider.dart';

import '../widgets/night_background.dart';
import '../widgets/my_content_area.dart';
import '../widgets/my_searchbar.dart';

class MyHomePage extends StatefulWidget {
  @override
  State<MyHomePage> createState() => _MyHomePageState();
}

class _MyHomePageState extends State<MyHomePage>
    with SingleTickerProviderStateMixin {
  /// Current selected music app,
  /// 0 represents local music app, 1 represents QQ music,
  /// 2 represents netease music, 3 represents bilibili.
  var currentMusicApp = 0;
  final GlobalKey<ScaffoldState> _scaffoldKey = GlobalKey<ScaffoldState>();

  late AnimationController _animationController;
  // late AnimationController _controller;
  late Animation<Color?> _colorAnimation;
  late Animation<double> _heightAnimation;
  late Animation<double> _footerHeightAnimation;
  late Animation<Offset> _slideAnimation;
  late Animation<double> _fadeAnimation;
  @override
  void initState() {
    super.initState();
    _animationController = AnimationController(
      duration: const Duration(milliseconds: 1500),
      vsync: this,
    );
    _colorAnimation = ColorTween(
      begin: Colors.amber,
      end: Colors.blue,
    ).animate(_animationController);
    _heightAnimation = Tween<double>(
      begin: 0.0,
      end: 1.0,
    ).animate(_animationController);
    _footerHeightAnimation = Tween<double>(
      begin: 0.79,
      end: 1.0,
    ).animate(_animationController);
    _slideAnimation = Tween<Offset>(
      begin: Offset.zero,
      end: Offset(0, 1),
    ).animate(_animationController);
    _fadeAnimation = Tween<double>(
      begin: 1,
      end: 0,
    ).animate(_animationController);
  }

  @override
  void dispose() {
    _animationController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      key: _scaffoldKey,
      drawer: Drawer(
        backgroundColor: Colors.transparent,
        width: MediaQuery.of(context).size.width * 0.75,
        child: NightBackground(),
        // child: MySideDrawer(),
      ),
      body: SafeArea(
        child: ChangeNotifierProvider(
          create: (context) => MyNavigationButtonState(),
          child: Stack(
            alignment: Alignment.topCenter,
            children: [
              AnimatedBuilder(
                animation: _animationController,
                builder: (BuildContext context, Widget? child) {
                  return Positioned(
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: MediaQuery.of(context).size.height - 96.7,
                    child: Container(
                      // height: 64.0,
                      color: Colors.white,
                      child: MySearchBar(
                          myScaffoldKey: _scaffoldKey,
                          animationController: _animationController),
                    ),
                  );
                },
              ),
              AnimatedBuilder(
                animation: _animationController,
                builder: (BuildContext context, Widget? child) {
                  return Positioned(
                    top: MediaQuery.of(context).size.height *
                        _heightAnimation.value,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    child: child!,
                  );
                },
                child: Container(
                  decoration: BoxDecoration(
                    gradient: LinearGradient(
                      colors: [
                        Color(0xFF75B6F8),
                        Color(0xFFD3EAFF),
                        Color(0xFFF1F8FF),
                        Color(0xFFFFFFFF),
                        Color(0xFFFFEED9),
                      ],
                      stops: [0.0, 0.38, 0.6, 0.81, 1.0],
                      begin: Alignment.topCenter,
                      end: Alignment.bottomCenter,
                    ),
                  ),
                  child: QuickActionMenu(
                    backgroundColor: Colors.transparent,
                    imageUri: 'assets/images/home_button.png',
                    onTap: () {},
                    actions: [
                      QuickAction(
                        imageUri: 'assets/images/bilibili.png',
                        onTap: () {
                          print('bilibili');
                        },
                      ),
                      QuickAction(
                        imageUri: 'assets/images/netease.png',
                        onTap: () {
                          print('netease');
                        },
                      ),
                      QuickAction(
                        imageUri: 'assets/images/qqmusic.png',
                        onTap: () {
                          print('qqmusic');
                        },
                      ),
                    ],
                    child: Column(
                      children: [
                        Expanded(
                          child: Padding(
                            // padding: const EdgeInsets.fromLTRB(
                            //     12.0, 76.0, 12.0, 80.0),
                            padding:
                                EdgeInsets.fromLTRB(12.0, 76.0, 12.0, 0.0),
                            child: MyContentArea(),
                          ),
                        ),
                        MyFooter(),
                      ],
                    ),
                  ),
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
